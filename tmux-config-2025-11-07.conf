# Tmux Configuration

# Set prefix to ` (backtick)
unbind C-b
set-option -g prefix `
bind ` send-prefix

# Split panes using | and -
bind | split-window -h
bind - split-window -v
unbind '"'
unbind %

# Switch panes using Alt-arrow without prefix
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Enable mouse mode
set -g mouse on

# Don't rename windows automatically
set-option -g allow-rename off

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Reload config file
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# Increase history limit
set-option -g history-limit 10000

# Enable 256 colors
set -g default-terminal "screen-256color"

# Status bar styling
set -g status-bg black
set -g status-fg white
set -g status-left '#[fg=green]#S #[fg=white]| '
set -g status-right '#[fg=yellow]%Y-%m-%d %H:%M'
set -g status-right-length 50
set -g status-left-length 30

# Highlight active window
setw -g window-status-current-style 'fg=white,bg=red,bold'

# Pane border styling
set -g pane-border-style 'fg=colour8'
set -g pane-active-border-style 'fg=colour9'

# Message styling
set -g message-style 'fg=white,bg=black,bold'

# Copy mode improvements
setw -g mode-keys vi
bind-key -T copy-mode-vi v send -X begin-selection
bind-key -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"

# Quick window switching
bind-key -n C-S-Left swap-window -t -1
bind-key -n C-S-Right swap-window -t +1

# Resize panes easily
bind-key J resize-pane -D 5
bind-key K resize-pane -U 5
bind-key H resize-pane -L 5
bind-key L resize-pane -R 5

# ===== INTERESTING ADDITIONAL FEATURES =====

# Smart pane switching with awareness of Vim splits
# Install TPM first: git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'christoomey/vim-tmux-navigator'

# Better session management
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# System stats in status bar
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'tmux-plugins/tmux-battery'

# Copy to system clipboard
set -g @plugin 'tmux-plugins/tmux-yank'

# Fuzzy session switcher (prefix + s enhanced)
bind-key s run-shell 'tmux list-sessions -F "#{session_name}" | fzf --reverse | xargs tmux switch-client -t'

# Quick window creation with name prompt
bind-key N command-prompt -p "New window name:" "new-window -n '%%'"

# Toggle pane synchronization (type in all panes simultaneously)
bind-key S set-window-option synchronize-panes\; display-message "synchronize-panes is now #{?pane_synchronized,on,off}"

# Create new session from current directory
bind-key C new-session -c "#{pane_current_path}"

# Kill session and switch to another (if available)
bind-key X confirm-before -p "Kill session #S? (y/n)" "run-shell 'tmux switch-client -n \\\; kill-session -t \"#S\"'"

# Quick edit of tmux config
bind-key E new-window -n "tmux-config" "nvim ~/.tmux.conf"

# Toggle status bar
bind-key T set-option status

# Zoom current pane to new window
bind-key Z break-pane

# Put pane back to original window
bind-key B command-prompt -p "Join pane from window:" "join-pane -s '%%'"

# Quick layouts
bind-key M-1 select-layout even-horizontal
bind-key M-2 select-layout even-vertical
bind-key M-3 select-layout main-horizontal
bind-key M-4 select-layout main-vertical
bind-key M-5 select-layout tiled

# Clear screen and history
bind-key C-l send-keys 'C-l' \; clear-history

# Show/hide pane borders
bind-key P if -F '#{s/off//:status}' 'set status off' 'set status on'

# Enhanced status bar with plugins
set -g status-right '#[fg=cyan]CPU: #{cpu_percentage} #[default]| #[fg=green]Batt: #{battery_percentage} #[default]| #[fg=yellow]%Y-%m-%d %H:%M'
set -g status-right-length 100

# Plugin settings
set -g @resurrect-strategy-nvim 'session'
set -g @resurrect-capture-pane-contents 'on'
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'

# Better colors for tmux in terminal
set-option -sa terminal-overrides ",xterm*:Tc"

# Aggressive resize (useful for different screen sizes)
setw -g aggressive-resize on

# Activity monitoring
setw -g monitor-activity on
set -g visual-activity on

# Auto-renumber windows when one is deleted
set-option -g renumber-windows on

# Escape time for vim
set -sg escape-time 0

# Focus events for vim
set -g focus-events on

# Initialize TMUX plugin manager (keep this line at the very bottom)
run '~/.tmux/plugins/tpm/tpm'